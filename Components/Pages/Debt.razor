@page "/Debt"
@inject FineTrack.Database.ApplicationDbContext DbContext
@inject FineTrack.Services.BalanceService BalanceService

<h3>Debts</h3>
<p>Total Debt Transactions: @BalanceService.DebtTransactionCount</p>

@if (Debts == null)
{
        <p>Loading...</p>
}
else if (Debts.Count == 0)
{
        <p>No Debts records.</p>
}
else
{
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Amount</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>
                        Due Date
                        <button class="btn btn-link btn-sm" @onclick="ToggleSortByDueDate">
                        @((isSortingByDueDateAscending ? "↑" : "↓"))
                        </button>
                    </th>
                    <th>Source</th>
                    <th>
                        Debt Date
                        <button class="btn btn-link btn-sm" @onclick="ToggleSortByDebtDate">
                        @((isSortingByDebtDateAscending ? "↑" : "↓"))
                        </button>
                    </th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var debt in Debts)
            {
                        <tr>
                            <td>@debt.DebtId</td>
                            <td>@debt.DebtAmount.ToString("C")</td>
                            <td>@debt.DebtCategory</td>
                            <td>@debt.DebtStatus</td>
                            <td>@debt.DebtDueDate.ToString("yyyy-MM-dd")</td>
                            <td>@debt.DebtSource</td>
                            <td>@debt.DebtDate.ToString("yyyy-MM-dd")</td>
                            <td>@debt.DebtRemarks</td>
                        </tr>
            }
            </tbody>
        </table>
}

@code {
    private List<FineTrack.Database.Debt> Debts;
    private bool isSortingByDueDateAscending = true;
    private bool isSortingByDebtDateAscending = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Debts = await DbContext.ReadAllDebtAsync();
            SortByDebtDate(); // Default sorting by DebtDate ascending
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading Debts: {ex.Message}");
            Debts = new List<FineTrack.Database.Debt>();
        }
    }

    private void ToggleSortByDueDate()
    {
        isSortingByDueDateAscending = !isSortingByDueDateAscending;
        SortByDueDate();
    }

    private void SortByDueDate()
    {
        if (isSortingByDueDateAscending)
        {
            Debts = Debts.OrderBy(d => d.DebtDueDate).ToList();
        }
        else
        {
            Debts = Debts.OrderByDescending(d => d.DebtDueDate).ToList();
        }
    }

    private void ToggleSortByDebtDate()
    {
        isSortingByDebtDateAscending = !isSortingByDebtDateAscending;
        SortByDebtDate();
    }

    private void SortByDebtDate()
    {
        if (isSortingByDebtDateAscending)
        {
            Debts = Debts.OrderBy(d => d.DebtDate).ToList();
        }
        else
        {
            Debts = Debts.OrderByDescending(d => d.DebtDate).ToList();
        }
    }
}
